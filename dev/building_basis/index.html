<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Subspace generation · Subspace_MESE.jl</title><meta name="title" content="Subspace generation · Subspace_MESE.jl"/><meta property="og:title" content="Subspace generation · Subspace_MESE.jl"/><meta property="twitter:title" content="Subspace generation · Subspace_MESE.jl"/><meta name="description" content="Documentation for Subspace_MESE.jl."/><meta property="og:description" content="Documentation for Subspace_MESE.jl."/><meta property="twitter:description" content="Documentation for Subspace_MESE.jl."/><meta property="og:url" content="https://CRMSB.github.io/Subspace_MESE.jl/building_basis/"/><meta property="twitter:url" content="https://CRMSB.github.io/Subspace_MESE.jl/building_basis/"/><link rel="canonical" href="https://CRMSB.github.io/Subspace_MESE.jl/building_basis/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Subspace_MESE.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation/">Installation</a></li><li><a class="tocitem" href="../convert/">Convert data</a></li><li class="is-active"><a class="tocitem" href>Subspace generation</a><ul class="internal"><li><a class="tocitem" href="#How-to-build-a-subspace"><span>How to build a subspace</span></a></li><li><a class="tocitem" href="#Difference-between-the-3-methods"><span>Difference between the 3 methods</span></a></li><li class="toplevel"><a class="tocitem" href="#Exponential-subspace"><span>Exponential subspace</span></a></li><li class="toplevel"><a class="tocitem" href="#EPG-subspace"><span>EPG subspace</span></a></li><li class="toplevel"><a class="tocitem" href="#Calibration-subspace"><span>Calibration subspace</span></a></li></ul></li><li><a class="tocitem" href="../reconstruction_subspace/">Subspace Reconstruction</a></li><li><a class="tocitem" href="../fit_T2/">T₂ mapping</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../generated/examples/subspace_julia_epg/">Generate figure 8</a></li></ul></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Subspace generation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Subspace generation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/CRMSB/PAPER_subspace_MESE/blob/main/docs/src/building_basis.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Generate-Subspaces"><a class="docs-heading-anchor" href="#Generate-Subspaces">Generate Subspaces</a><a id="Generate-Subspaces-1"></a><a class="docs-heading-anchor-permalink" href="#Generate-Subspaces" title="Permalink"></a></h1><p>This package implements 3 different subspaces :</p><ul><li>Exponential</li><li>Extended Phase Graph (EPG)</li><li>Calibration</li></ul><h2 id="How-to-build-a-subspace"><a class="docs-heading-anchor" href="#How-to-build-a-subspace">How to build a subspace</a><a id="How-to-build-a-subspace-1"></a><a class="docs-heading-anchor-permalink" href="#How-to-build-a-subspace" title="Permalink"></a></h2><p>The 3 methods are based on the same concept :</p><p>Generate a dictionary with the signal evolution at each echo time <code>signal_dict</code></p><p>Apply a Singular Value Decomposition on it</p><pre><code class="language-julia hljs">svd_obj = svd(signal_dict)</code></pre><p>and then crop to the desired subspace dimension</p><pre><code class="language-julia hljs">basis = ComplexF32.(svd_obj.V)[:, 1:NUM_BASIS]</code></pre><p>This concept can be applied to create your own subspace, for example directly from echo images.</p><h2 id="Difference-between-the-3-methods"><a class="docs-heading-anchor" href="#Difference-between-the-3-methods">Difference between the 3 methods</a><a id="Difference-between-the-3-methods-1"></a><a class="docs-heading-anchor-permalink" href="#Difference-between-the-3-methods" title="Permalink"></a></h2><p>Exponential and EPG subspace generate a dictionary with the signal evolution of the Multi-Echo Spin-Echo sequence for various <span>$T_2$</span> (or <span>$B_1$</span> for the EPG case).</p><p>The calibration subspace reconstructs low-resolution images at each Echo Time with the  fully sampled area of the k-space.</p><h1 id="Exponential-subspace"><a class="docs-heading-anchor" href="#Exponential-subspace">Exponential subspace</a><a id="Exponential-subspace-1"></a><a class="docs-heading-anchor-permalink" href="#Exponential-subspace" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Subspace_MESE.MESE_basis_exp" href="#Subspace_MESE.MESE_basis_exp"><code>Subspace_MESE.MESE_basis_exp</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">    MESE_basis_exp(NUM_BASIS::Int,TE::AbstractFloat,ETL::Int, T2_vec::AbstractVector;removeFirstPoint::Bool=false)</code></pre><p>Generate a temporal basis for a Multi-Echo Spin-Echo sequence with an exponential model.for various value of T2  stored as a vector in <code>T2_vec</code>. The first point of the echo train can be removed from the dictionnary  with the keyword <code>removeFirstPoint</code> to minimize the effect of stimulated echoes. </p><p><strong>Input :</strong></p><pre><code class="nohighlight hljs">- `NUM_BASIS::Int : Number of temporal basis to extract
- `TE::AbstractFloat` : Cartesian acquisition with a fully-sampled center.
- `ETL::Int` : Echo Train Length
- `T2_vec::AbstractVector` : Vector of T₂ values used to generate the signal dictionnary</code></pre><p><strong>Keyword :</strong></p><pre><code class="nohighlight hljs">- `removeFirstPoint::Bool=False` : Remove the first point of the dictionnary before the svd</code></pre><p><strong>Output :</strong></p><pre><code class="nohighlight hljs">- `basis` : Matrix of size (ETL,NUM_BASIS)
- `exp_dict` : Dictionnary of signal used to generate the basis</code></pre><p><strong>Example :</strong></p><pre><code class="language-julia hljs">T2_vec = 1.0:1.0:2000.0
TE = 7.0
ETL = 50
NUM_BASIS = 6

basis_exp,exp_dict = MESE_basis_exp(NUM_BASIS,TE,ETL,T2_vec)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CRMSB/PAPER_subspace_MESE/blob/d03423b9abba8e0807eda2903363300801ee8dbf/src/build_basis.jl#L53-L82">source</a></section></article><p>In the publication, the subspace is extracted from a dictionary generated with a range of <span>$T_2$</span> from 1 ms to 2000 ms with a step of 1 ms.</p><p>Other approachs can be used :</p><ul><li>a logarithmic repartition of <span>$T_2$</span> </li><li>extracting from a fully acquisition the distribution of <span>$T_2$</span> and then generate from that distribution the dictionary (Tamir et al, MRM,2017)</li></ul><p>Let&#39;s take a look at the first 6 subspace vectors from a linear repartition :</p><pre><code class="language-julia hljs">using Subspace_MESE

T2_vec = 1.0:1.0:2000.0
TE = 7.0
ETL = 50
NUM_BASIS = 6

basis_exp,_=MESE_basis_exp(NUM_BASIS,TE,ETL,T2_vec)

using CairoMakie
color = Makie.wong_colors()
f = Figure()
ax=Axis(f[1,1])
for b in 1:6
    lines!(ax,abs.(basis_exp[:,b]),color=color[b],label = &quot;Basis n°$b&quot;)
end
hidedecorations!(ax)
axislegend(ax)
f</code></pre><img src="c2345dab.png" alt="Example block output"/><h1 id="EPG-subspace"><a class="docs-heading-anchor" href="#EPG-subspace">EPG subspace</a><a id="EPG-subspace-1"></a><a class="docs-heading-anchor-permalink" href="#EPG-subspace" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Subspace_MESE.MESE_basis_EPG" href="#Subspace_MESE.MESE_basis_EPG"><code>Subspace_MESE.MESE_basis_EPG</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">MESE_basis_EPG(NUM_BASIS::Int,TE,ETL::Int,T2_vec::Union{AbstractVector,AbstractFloat},B1_vec::Union{AbstractVector,AbstractFloat} = 1.0,T1_vec::Union{AbstractVector,AbstractFloat}=1000.0;TR = 1000.0,dummy::Int = 3)

Generate a temporal basis for a Multi-Echo Spin-Echo sequence with an Extended Phase Graph model for various value of T2/B1/T1</code></pre><p>stored as a vector in <code>T2_vec</code>/<code>B1_vec</code>/<code>T1_vec</code>.</p><p><strong>Input :</strong></p><pre><code class="nohighlight hljs">- `NUM_BASIS::Int : Number of temporal basis to extract
- `TE::AbstractFloat` : Cartesian acquisition with a fully-sampled center.
- `ETL::Int` : Echo Train Length
- `T2_vec::Union{AbstractVector,AbstractFloat}` : Vector of T₂ values used to generate the signal dictionnary 
- `B1_vec::Union{AbstractVector,AbstractFloat}` : Vector of B₁ values used to generate the signal dictionnary 
- `T1_vec::Union{AbstractVector,AbstractFloat}` : Vector of T₁ values used to generate the signal dictionnary</code></pre><p><strong>Keyword :</strong></p><pre><code class="nohighlight hljs">- `TR` : Repetition time
- `dummy` : Number of dummy scan before extracting the signal value</code></pre><p><strong>Output :</strong></p><pre><code class="nohighlight hljs">- `basis` : Matrix of size (ETL,NUM_BASIS)
- `epg_dict` : Dictionnary of signal used to generate the basis</code></pre><p><strong>Example :</strong></p><pre><code class="language-julia hljs">B1_vec = 0.8:0.01:1.0
T2_vec = 1.0:1.0:2000.0
T1_vec = 1000.0 #can also be a float
TE = 7.0
TR = 1000.0
dummy=3
ETL = 50
NUM_BASIS = 6

basis_epg, epg_dict =MESE_basis_EPG(NUM_BASIS,TE,ETL,T2_vec,B1_vec,T1_vec;TR=TR,dummy=dummy)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CRMSB/PAPER_subspace_MESE/blob/d03423b9abba8e0807eda2903363300801ee8dbf/src/build_basis.jl#L103-L138">source</a></section></article><p>In order to generate the EPG subspace, more parameters need to be defined. Specifically, the range of <span>$B_1$</span> to be expected in the acquisition might be larger for surfacic transmit coil than for volumic coils that have a homogeneous <span>$B_1^+$</span> field.</p><p>Of note, B1<em>vec, T2</em>vec, T1<em>vec can also be passed as float values rather than vectors. In the publication, the T1</em>vec was fixed to 1000 ms.</p><pre><code class="language-julia hljs">using Subspace_MESE
B1_vec = 0.8:0.01:1.0
T2_vec = 1.0:1.0:2000.0
T1_vec = 1000.0 #can also be a vector of float
TE = 7.0
TR = 1000.0
dummy=3
ETL = 50
NUM_BASIS = 6

basis_epg,_=MESE_basis_EPG(NUM_BASIS,TE,ETL,T2_vec,B1_vec,T1_vec;TR=TR,dummy=dummy)

using CairoMakie
color = Makie.wong_colors()
f = Figure()
ax=Axis(f[1,1])
for b in 1:6
    lines!(ax,abs.(basis_epg[:,b]),color=color[b],label = &quot;Basis n°$b&quot;)
end
hidedecorations!(ax)
axislegend(ax)
f</code></pre><img src="522bd3f2.png" alt="Example block output"/><h1 id="Calibration-subspace"><a class="docs-heading-anchor" href="#Calibration-subspace">Calibration subspace</a><a id="Calibration-subspace-1"></a><a class="docs-heading-anchor-permalink" href="#Calibration-subspace" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Subspace_MESE.basis_calibration" href="#Subspace_MESE.basis_calibration"><code>Subspace_MESE.basis_calibration</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">basis_calibration(NUM_BASIS::Int,acq::AcquisitionData{T,D},crop_size::NTuple{D,Int}) where {T,D}</code></pre><p>k_bart = kDataCart(acq);  </p><p>Extract a temporal basis from a low-resolution images reconstructed using a fully sampled  area at the center of the k-space with a size <code>crop_size</code>. </p><p><strong>Input :</strong></p><pre><code class="nohighlight hljs">- `NUM_BASIS::Int : Number of temporal basis to extract
- `acq::AcquisitionData` : Cartesian acquisition with a fully-sampled center.
- `crop_size::NTuple{D,Int})` : size of the  central part of k-space used</code></pre><p><strong>Output :</strong></p><pre><code class="nohighlight hljs">- `basis` : Matrix of size (ETL,NUM_BASIS)
- `calib_dict` : Dictionnary of signal used to generate the basis</code></pre><p><strong>Example :</strong></p><pre><code class="language-julia hljs">b = BrukerFile(&quot;path/to/dataset&quot;)

raw = RawAcquisitionData_MESE(b)
acq = AcquisitionData(raw,OffsetBruker = true);

basis, calib_dict = MESE_basis_calibration(acq,(15,15,15),6)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CRMSB/PAPER_subspace_MESE/blob/d03423b9abba8e0807eda2903363300801ee8dbf/src/build_basis.jl#L8-L33">source</a></section></article><p>The calibration subspace reconstructs low-resolution images from a fully sampled area of the k-space. </p><p>You can generate the subspace from the acquired accelerated acquisition with the parameter <code>crop_size</code> equal to the size of the fully sampled area of the k-space.</p><p>But you can also generate the subspace from a different fully acquisition (for example on a control acquisition)</p><pre><code class="language-julia hljs">b = BrukerFile(&quot;path/to/dataset&quot;)

raw = RawAcquisitionData_MESE(b)
acq = AcquisitionData(raw,OffsetBruker = true);

basis,_ = MESE_basis_calibration(acq,(15,15,15),6)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../convert/">« Convert data</a><a class="docs-footer-nextpage" href="../reconstruction_subspace/">Subspace Reconstruction »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.3.0 on <span class="colophon-date" title="Friday 3 May 2024 13:46">Friday 3 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
