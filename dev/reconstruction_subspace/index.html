<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Subspace Reconstruction · Subspace_MESE.jl</title><meta name="title" content="Subspace Reconstruction · Subspace_MESE.jl"/><meta property="og:title" content="Subspace Reconstruction · Subspace_MESE.jl"/><meta property="twitter:title" content="Subspace Reconstruction · Subspace_MESE.jl"/><meta name="description" content="Documentation for Subspace_MESE.jl."/><meta property="og:description" content="Documentation for Subspace_MESE.jl."/><meta property="twitter:description" content="Documentation for Subspace_MESE.jl."/><meta property="og:url" content="https://CRMSB.github.io/Subspace_MESE.jl/reconstruction_subspace/"/><meta property="twitter:url" content="https://CRMSB.github.io/Subspace_MESE.jl/reconstruction_subspace/"/><link rel="canonical" href="https://CRMSB.github.io/Subspace_MESE.jl/reconstruction_subspace/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Subspace_MESE.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation/">Installation</a></li><li><a class="tocitem" href="../convert/">Convert data</a></li><li><a class="tocitem" href="../building_basis/">Subspace generation</a></li><li class="is-active"><a class="tocitem" href>Subspace Reconstruction</a><ul class="internal"><li><a class="tocitem" href="#Background"><span>Background</span></a></li><li><a class="tocitem" href="#Julia-implementation"><span>Julia implementation</span></a></li><li><a class="tocitem" href="#Comparison-with-BART"><span>Comparison with BART</span></a></li></ul></li><li><a class="tocitem" href="../fit_T2/">T₂ mapping</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../generated/examples/subspace_julia_epg/">Generate figure 8</a></li></ul></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Subspace Reconstruction</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Subspace Reconstruction</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/CRMSB/PAPER_subspace_MESE/blob/main/docs/src/reconstruction_subspace.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Compressed-sensing-reconstruction-with-a-subspace-constrained"><a class="docs-heading-anchor" href="#Compressed-sensing-reconstruction-with-a-subspace-constrained">Compressed sensing reconstruction with a subspace constrained</a><a id="Compressed-sensing-reconstruction-with-a-subspace-constrained-1"></a><a class="docs-heading-anchor-permalink" href="#Compressed-sensing-reconstruction-with-a-subspace-constrained" title="Permalink"></a></h1><h2 id="Background"><a class="docs-heading-anchor" href="#Background">Background</a><a id="Background-1"></a><a class="docs-heading-anchor-permalink" href="#Background" title="Permalink"></a></h2><p>The main idea is to solve the following problem :</p><p class="math-container">\[\min_\alpha \frac{1}{2}||y - E \Phi_K \alpha||^2_2 + \lambda||W(\alpha)||_1\]</p><p>where <strong>y</strong> is the k-space data, <strong>E</strong> is the encoding operator regrouping the FFT operator and the coil sensitvity operator. <strong><span>$\Phi_K$</span></strong> is the subspace cropped to the first K temporal dimensions, <strong><span>$\alpha$</span></strong> is the subspace coefficient maps and <strong>W</strong> corresponds to the Wavelet Operator which is applied on <strong><span>$\alpha$</span></strong>.</p><h2 id="Julia-implementation"><a class="docs-heading-anchor" href="#Julia-implementation">Julia implementation</a><a id="Julia-implementation-1"></a><a class="docs-heading-anchor-permalink" href="#Julia-implementation" title="Permalink"></a></h2><p>The subspace reconstruction was implemented as part of <a href="https://github.com/MagneticResonanceImaging/MRIReco.jl">MRIReco.jl</a> package. An example in the MRIReco.jl package can be found <a href="https://magneticresonanceimaging.github.io/MRIReco.jl/latest/generated/examples/03-subspaceReconstruction/">here</a>.</p><p>The reconstruction works on an <code>AcquisitionData</code> object (previously converted from the Bruker raw dataset). Because it is a combined parallel imaging and compressed sensing approach, we have to estimate the coil sensitivity map.</p><pre><code class="language-julia hljs">using Subspace_MESE
using Subspace_MESE.MRIFiles
using Subspace_MESE.MRIReco
using Subspace_MESE.MRICoilSensitivities

b=BrukerFile(&quot;path/to/dataset/&quot;)
raw = RawAcquisitionData_MESE(b)
acq = AcquisitionData(raw,OffsetBruker = true);

coilsens = espirit(acq,eigThresh_2=0.0);
basis,dico = basis_calibration(6,acq,(15,15,15))</code></pre><p>From that point, we need to define a Dict structure (here named <code>params</code>) to store and pass the MRIReco reconstruction parameters.</p><pre><code class="language-julia hljs">params = Dict{Symbol,Any}()
params[:reconSize] = acq.encodingSize

# Subspace 
params[:reco] = &quot;multiCoilMultiEchoSubspace&quot;
params[:senseMaps] = coilsens
params[:basis] = basis

# Compressed sensing transform
params[:regularization] = &quot;L1&quot;
params[:sparseTrafo] = &quot;Wavelet&quot; #sparse trafo
params[:λ] = Float32(0.01)

# Algorithm parameters
params[:solver] = &quot;fista&quot;
params[:iterations] = 30
params[:normalizeReg] = true</code></pre><p><code>params[:reco] = &quot;multiCoilMultiEchoSubspace&quot;</code> means that it is a subspace reconstruction with parallel imaging and needs the fields <code>params[:senseMaps]</code> and <code>params[:basis]</code></p><p>The remaining parameters are linked to the algorithm used, here a wavelet transform + L1 regularization with a FISTA algorithm and 30 iterations.</p><p>To perform the reconstruction we can now call the function :</p><pre><code class="language-julia hljs">alpha = reconstruction(acq, params);</code></pre><p>The results of the reconstruction is not directly the echo images but the subspace coefficient maps. In order to get the virtual echo images, the subspace needs to be applied on this coefficient maps.</p><pre><code class="language-julia hljs">im_TE = abs.(applySubspace(α, basis))</code></pre><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>The reconstruction part might evolve due to changes in the <strong>MRIReco</strong> package and its dependencies, particularly <strong>RegularizedLeastSquares.jl</strong></p></div></div><h2 id="Comparison-with-BART"><a class="docs-heading-anchor" href="#Comparison-with-BART">Comparison with BART</a><a id="Comparison-with-BART-1"></a><a class="docs-heading-anchor-permalink" href="#Comparison-with-BART" title="Permalink"></a></h2><p>All the figures (except some parts of figure 8) from the publication were generated using a reconstruction from BART. For comparison purpose, the reconstruction is also available in this package and detailed below.</p><p>You need to compile the BART toolbox : https://mrirecon.github.io/bart/ and pass as an argument the path to the executable BART library in the <code>subspace_bart_reconstruction</code> function.</p><p>This package uses the wrapper <code>BartIO.jl</code> to send the data back and forth between JULIA and BART.</p><pre><code class="language-julia hljs">using Subspace_MESE.BartIO

params = Dict{Symbol,Any}()
params[:iterations] = 60
params[:λ] = 0.01
params[:basis]=basis

im_sub_bart,im_TE_bart = subspace_bart_reconstruction(acq,params,&quot;/home/CODE/bart/bart&quot;)</code></pre><p>If you need more control over the reconstruction parameters for BART, take a look at the function (only 20 lines)</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The regularization parameters between MRIReco.jl and BART are different and need to be adjusted manually. This can be explained by some low-level differences in the FISTA algorithm / Wavelet transform and also due to scaling of the data prior to the algorithm.</p></div></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../building_basis/">« Subspace generation</a><a class="docs-footer-nextpage" href="../fit_T2/">T₂ mapping »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.3.0 on <span class="colophon-date" title="Tuesday 3 December 2024 09:42">Tuesday 3 December 2024</span>. Using Julia version 1.11.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
